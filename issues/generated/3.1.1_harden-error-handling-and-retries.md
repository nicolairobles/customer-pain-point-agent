# 3.1.1 â€“ Harden error handling and retries

## Summary (Work Breakdown)

- **Description:** Introduce resilient error handling, structured logging, and retry/backoff policies across tools and the agent.
- **Work Package:** 3.1 Error Handling & Retry Logic
- **Duration:** 3 hours
- **Owner(s):** TBD

- **Context:** Phase 1 established baseline tooling but surfaced brittle behaviour when upstream APIs throttle or return partial payloads. Phase 3 focuses on eliminating user-visible crashes by centralising error taxonomy, surfacing actionable messages in the Streamlit UI, and ensuring retries honour provider rate limits.

## Acceptance Criteria
- [ ] Define a shared `ToolError`/`RetryableError` schema under `src/utils/errors.py` (or equivalent) and migrate Reddit/Twitter/Google tools to raise structured exceptions with status codes and remediation hints.
- [ ] Implement exponential backoff with jitter for retryable failures (HTTP 5xx, rate limits) leveraging `tenacity` or custom logic; retries must respect per-provider ceilings exposed in configuration.
- [ ] Update `src/agent/pain_point_agent.py` (and orchestrator) to aggregate tool-level errors into a diagnostics payload consumed by `app/components/results_display.py`.
- [ ] Ensure Streamlit UI renders partial results with contextual warnings (preserving sanitisation work from 1.4.3/1.4.4) and directs the user toward next steps.
- [ ] Document failure modes and escalation paths in `docs/runbook/error-handling.md` (new file) with at least three representative scenarios.

## Test Criteria
- [ ] **Unit Tests:** Add focused tests for retry decorators (mock time/backoff), error serialization, and UI messaging in `tests/test_results_display.py`.
- [ ] **Integration Test:** Simulate throttled responses in `tests/test_agent.py` (or new integration harness) to confirm the agent surfaces partial results without raising uncaught exceptions.
- [ ] **Manual QA:** Execute `streamlit run app/streamlit_app.py`, trigger mocked tool failures (e.g., via feature flag), and verify warnings align with the documented playbook.

## Notes
- Coordinate with Phase 2 Twitter/Google tool owners to share retry utilities and avoid duplicated logic.
- Keep logging structured (JSON-ready) so future observability tooling (LangSmith/TruLens) can hook into the same error taxonomy.


