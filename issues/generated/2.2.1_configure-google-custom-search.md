# 2.2.1 – Configure Google Custom Search

## Summary (Work Breakdown)

- **Description:** Set up API credentials, environment, and smoke tests
- **Work Package:** 3.2.1 Google Search Configuration
- **Duration:** 1 hour
- **Story Points:** 2
- **Owner(s):** Nicolai

- **Story Detail:** https://github.com/nicolairobles/customer-pain-point-agent/blob/master/docs/stories/2.2.1-configure-google-custom-search.md

## Detailed Story

# Story 2.2.1 – Configure Google Custom Search

## Purpose
Establish authenticated access to the Google Custom Search API and document configuration so the agent can query the web reliably.

## Instructions: Obtaining and Documenting Google API Credentials

To enable Google Custom Search integration, you must obtain two credentials:
1. **Google Custom Search API Key**
2. **Custom Search Engine (CSE) ID**

#### Steps to Obtain Google API Key and CSE ID

1. [X] **Create/Log in to a Google Account**
	- Visit https://console.cloud.google.com/ and sign in.

2. [X] **Create a New Project (Optional but recommended)**
	- Click the project dropdown (top left) > "New Project" > Name it (e.g., "Pain Point Agent") > Create.

3. [X] **Enable Custom Search API**
	- In the Cloud Console, go to "APIs & Services" > "Enable APIs and Services".
	- Search for "Custom Search API" and enable it for your project.

4. [X] **Get an API Key**
	- In "APIs & Services" > "Credentials" > "Create Credentials" > "API key".
	- Copy the generated API key.

5. [X] **Create a Custom Search Engine (CSE)**
	- Go to https://cse.google.com/cse/all
	- Click "Add" > Enter a site (e.g., `www.reddit.com` or `*` for the whole web) > Create.
	- In the CSE control panel, set "Search the entire web" if needed.
	- Copy the CSE ID (listed under "Details" or "Control Panel").

6. [X] **Store Credentials Securely**
	- Add the following to your `.env` file (do not commit this file):
	  ```
      GOOGLE_SEARCH_API_KEY=your_api_key_here
      GOOGLE_SEARCH_ENGINE_ID=your_cse_id_here
	  ```
	- If `.env.example` exists, add these variable names as placeholders for onboarding.

7. [X] **Document in README**
	- Update the README with a section on "Google API Setup" referencing these steps.

8. [X] **Test Integration**
	- Run the smoke test script at `scripts/test_google_search.py` to verify credentials are working. Example:

	  ```bash
	  source .venv/bin/activate
	  pip install -r requirements.txt
	  python scripts/test_google_search.py --query "site:reddit.com customer pain points"
	  ```

	- Check output for `Returned N items` and `SUMMARY_JSON` to confirm connectivity.

**Note:**
- Never share your API key or CSE ID publicly.
- Each developer should obtain and store their own credentials unless a shared set is provided securely.


## Acceptance Criteria
- [X] `.env` (local-only) includes placeholders for `GOOGLE_SEARCH_API_KEY` and `GOOGLE_SEARCH_ENGINE_ID` with guidance copied to `docs/api_setup.md`.
- [X] `config.settings` exposes the Google credentials through `settings.api` and validates that values are non-empty at runtime.
- [X] Smoke script created at `scripts/test_google_search.py` to verify Google API connectivity with quota-safe queries.
- [X] Documented rate limits, quota considerations, and cost implications recorded in `docs/api_setup.md`.
- [ ] Team members acknowledge configuration steps in project log or shared checklist.

## Implementation notes / learnings

- Added `GoogleSearchTool` implementation in `src/tools/google_search_tool.py` which uses `googleapiclient` and normalizes results to a minimal schema.
- Added runtime checks: `GoogleSearchTool` raises a `RuntimeError` when `GOOGLE_SEARCH_API_KEY` or `GOOGLE_SEARCH_ENGINE_ID` are missing from `settings.api`.
- Added `settings.api.validate_required()` helper for programmatic checks elsewhere.
- Created a smoke-test script `scripts/test_google_search.py` and saved a sample output to `examples/google_smoke_output.json` for reference.
- Updated `README.md` and `docs/api_setup.md` with setup and quota guidance.
- Tests: adjusted `tests/test_tools.py` to account for the implemented tool and verified factory methods work.

If you'd like, I can now commit and push this branch and open a PR; per your process I'll wait for your confirmation before pushing.

## Test Criteria
- [X] **Configuration Test**: Load settings in a Python REPL to confirm credentials round-trip correctly from environment variables.
- [ ] **Smoke Test**: Run the Google connectivity script and capture output demonstrating response status and result count.
- [ ] **Documentation Review**: Peer review `docs/api_setup.md` changes to ensure clarity and completeness.
