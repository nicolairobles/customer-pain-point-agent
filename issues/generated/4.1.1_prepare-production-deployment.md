# 4.1.1 – Prepare production deployment

## Summary (Work Breakdown)

- **Description:** Deploy the Streamlit application to the target hosting environment with environment-specific configuration and monitoring.
- **Work Package:** 4.1 Production Deployment
- **Duration:** 3 hours
- **Owner(s):** TBD

- **Context:** With Phase 3 hardening complete, the app is ready for a managed deployment (Streamlit Community Cloud or internal infrastructure). This work packages the runtime environment, secrets management, and smoke-test automation so releases can be repeated reliably.

## Acceptance Criteria
- [x] Create deployment IaC or scripted automation (e.g., Streamlit Cloud manifest, GitHub Action workflow) that provisions the app with pinned Python/langchain versions.
  - [x] GitHub Actions workflow: `.github/workflows/deploy.yml` builds/tests and publishes a GHCR image on `master` or via `workflow_dispatch`.
  - [x] Dependency pinning: `requirements.txt` pins runtime versions (including LangChain).
  - [x] Python pinning: `runtime.txt` pins Streamlit Cloud to Python 3.11.
- [x] Configure environment variables/secrets for Reddit, Twitter, Google, and OpenAI without embedding credentials in source control.
  - [x] Added `.dockerignore` to prevent baking local `.env` into images.
  - [x] Documented env vars + expected modes in `docs/deployment/production-deployment.md`.
- [x] Establish health checks or uptime monitoring (Streamlit status page, Pingdom, etc.) and alert routing documented for the team.
  - [x] Docker `HEALTHCHECK` uses `scripts/healthcheck.py`; Google secrets are only required when `TOOL_GOOGLE_SEARCH_ENABLED=true`.
- [x] Produce a rollback plan covering dependency pin reversion and content cache flush procedures.
  - [x] Rollback guidance documented in `README.md` and `docs/deployment/production-deployment.md`.
- [x] Update `README.md` with a deployment section that references the automation and outlines manual fallback steps.

## Test Criteria
- [ ] **Smoke Test:** After deployment, run the regression checklist from Phase 3 and capture screenshots of successful queries.
- [ ] **Disaster Recovery Drill:** Simulate a failed deploy (e.g., revert to previous commit) and demonstrate rollback steps within 15 minutes.
- [ ] **Monitoring Validation:** Trigger a synthetic downtime event (pause app) and confirm alerts reach the responsible Slack/email channel.

## Notes
- Coordinate with dependency automation (Issue 5.1.2) so deployment workflows can run on update PRs.
- Ensure compliance with API terms of service—validate host IP ranges if additional allow-listing is required.
