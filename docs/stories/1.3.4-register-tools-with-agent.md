# Story 1.3.4 - Register Tools with Agent

## Purpose
Ensure all external data source tools are properly registered and discoverable by the LangChain agent.

## Acceptance Criteria
- [x] Tool definitions expose accurate `name`, `description`, and argument schemas.
- [x] Agent registration occurs in a single orchestrator module with isolated configuration logic.
- [x] Tools can be toggled on/off via settings for debugging or feature flags.
- [x] Documentation describes how new tools should be added following the same pattern.
- [x] Telemetry hooks capture which tools were invoked during each run.

## Test Criteria
- [x] **Unit Tests**: Validate tool registry returns expected set given configuration toggles.
- [ ] **Integration Test**: Run agent with each tool enabled individually to confirm compatibility.
- [x] **Logging Review**: Inspect logs to ensure tool invocation metadata is captured without leaking credentials.

## How to add a new tool
1) **Create the tool module** under `src/tools/` following the existing pattern:
   - Subclass `langchain.tools.BaseTool`.
   - Define `name`, `description`, and a strict `args_schema` (Pydantic v2 with `ConfigDict(extra="forbid")`).
   - Provide a `.from_settings(settings: Settings)` factory to pass shared config/credentials.
   - Implement `_run` (and `_arun` if async support is needed) to return JSON-serializable output.
2) **Thread configuration/toggles**:
   - Add a feature flag to `config/settings.py::ToolSettings` (e.g., `TOOL_MYTOOL_ENABLED`).
   - Use that flag inside `src/agent/orchestrator.py::_iter_tools` to conditionally yield the tool.
3) **Register with the agent**:
   - Import the tool inside `_iter_tools` (lazy imports avoid test-time side effects).
   - Ensure the orchestrator remains the single place tools are wired.
4) **Tests**:
   - Add schema/instantiation coverage in `tests/test_tools.py` or a new test file near the feature.
   - Add a toggle test (similar to `tests/test_agent.py::test_tool_toggles`) to confirm enable/disable behavior.
5) **Docs + envs**:
   - Document any required credentials in `.env.example` and note the new toggle env var.
   - Update this story doc if the pattern changes.

## Telemetry
- Tool invocations are logged via a telemetry callback attached in `src/agent/orchestrator.py`.
- Each tool receives a `_TelemetryCallbackHandler` that records `tool_start`/`tool_end` events with sanitized input summaries (keys or truncated strings) to avoid leaking secrets.
- Events are emitted through the standard Python logger (`logging.getLogger(__name__)`), so they land in the app logs/console.
- `tests/test_agent.py::test_telemetry_logging_sanitizes_input` verifies the handler logs start/end and does not leak sensitive values.
