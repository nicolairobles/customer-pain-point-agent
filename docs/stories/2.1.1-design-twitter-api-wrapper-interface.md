# Story 2.1.1 â€“ Design Twitter API wrapper interface

## Purpose
Define a Twitter-specific abstraction that the agent and downstream tooling can rely on for consistent tweet retrieval and normalization.

## Acceptance Criteria
- [x] Interface contract documented (methods, parameters, return schema) using docstrings or a typed protocol.
- [x] Normalized fields cover: tweet text, author handle, permalink, created timestamp, like count, repost count, reply count, and language.
- [x] Authentication strategy specifies required configuration (bearer token, client id/secret) sourced from `config.settings`.
- [x] Rate limit, pagination, and query parameter options (hashtags, language, time window) are written up with clear guidance.
- [x] Design walkthrough completed with backend stakeholders and summary captured in the project log.

## Test Criteria
- [x] **Design Review**: Walk through at least three representative queries (single keyword, hashtag, and time-bound search) to confirm interface coverage.
- [x] **Schema Validation**: Produce a sample normalized payload and serialize it to JSON to verify the documented schema.
- [x] **Traceability**: Update `docs/architecture.md` and the activity entry in `docs/project-mgmt/work-breakdown.md` with any interface decisions.

## Design Walkthrough Summary

### Interface Contract
The `TwitterAPIWrapper` class provides the core API abstraction with the following key methods:

- `search_tweets(query, max_results=10, start_time=None, end_time=None, lang=None, next_token=None)`: Performs search with pagination support
- `normalize_tweet(tweet, users)`: Converts raw Tweepy Tweet objects to NormalizedTweet dataclass

The `TwitterTool` class extends LangChain's `BaseTool` for agent integration, with synchronous `_run` and asynchronous `_arun` methods.

### Normalized Schema
The `NormalizedTweet` dataclass ensures consistent data structure:

```python
@dataclass
class NormalizedTweet:
    text: str
    author_handle: str
    permalink: str
    created_timestamp: str  # ISO format
    like_count: int
    repost_count: int
    reply_count: int
    language: str
```

### Authentication Strategy
Authentication uses Twitter API v2 Bearer Token authentication. The token is sourced from `config.settings.api.twitter_api_key` and passed to the `TwitterAPIWrapper` constructor.

### Rate Limits and Pagination
- Twitter API v2 allows 300 requests per 15 minutes for recent search
- Pagination handled via `next_token` parameter
- Query parameters support: hashtags (#example), keywords, language filters (lang:en), time windows (start_time/end_time in ISO 8601)

### Representative Query Examples
1. **Single keyword**: `search_tweets("customer service")` - Basic text search
2. **Hashtag**: `search_tweets("#CustomerSupport")` - Hashtag-specific search  
3. **Time-bound**: `search_tweets("complaint", start_time="2024-01-01T00:00:00Z", end_time="2024-01-02T00:00:00Z")` - Temporal filtering

### Schema Validation Sample
```json
{
  "text": "Having issues with customer service response times #frustrated",
  "author_handle": "user123",
  "permalink": "https://twitter.com/user123/status/1234567890",
  "created_timestamp": "2024-01-15T10:30:00.000Z",
  "like_count": 25,
  "repost_count": 5,
  "reply_count": 8,
  "language": "en"
}
```

### Traceability Updates
- Added Twitter tool reference to `docs/architecture.md`
- Updated work breakdown structure in `docs/project-mgmt/work-breakdown.md`

